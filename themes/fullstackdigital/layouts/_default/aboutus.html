{{ define "main" }}

{{ range .Site.Data.navigation.main }}
{{- /* <!--here are the vars --> */ -}}

{{ $name := "" }}
{{ $url := "" }}
{{ $sub := "" }}
{{ $title := ""}}
{{ $active := false }}
{{ $pageName := ""}}
{{ $currentPage := $.Permalink }}

{{- /* <!--create the nav item based on the datafile values --> */ -}}
    {{ with .name }}
        {{ $name = lower . }}
        {{ $title = . }}
    {{ end }}
    {{ with .title }}
        {{ $title = . }}
    {{ end }}
    {{ with .url }}
        {{ $url = . }}
    {{ end }}
    
{{ range $index, $nav := where $.Site.Pages ".Params.name" $name }}
    {{ $pageName = lower .Params.name }}
        {{ if eq $pageName $name }}
            {{- /* <!--grab the permalink if page exists --> */ -}}
            {{ if eq $url "" }}
                {{ $url = .Permalink }}
            {{ end }}
            {{ if eq $currentPage $url }}
                {{ $active = true }}
            {{ end }}
        {{ end }}
{{ end }}
<li{{ if eq $active true }} class="active"{{ end }}><a href ="{{ $url }}">{{ $title }}</a>

{{ if .sub }}

{{ $name = "" }}
{{ $url = "" }}
{{ $sub = "" }}
{{ $title = ""}}
{{ $active = false }}
{{ $pageName = ""}}
{{ $currentPage = $.Permalink }}

    <ul class="sub">
    {{ range .sub }}
        {{ with .name }}
            {{ $name = lower . }}
            {{ $title = . }}
        {{ end }}
        {{ with .title }}
            {{ $title = . }}
        {{ end }}
        {{ if .url }}
            {{ $url = .url }}
          {{ else }}
            {{ $url = "" }}
        {{ end }}

        {{ range $index, $subnav := where $.Site.Pages ".Params.name" "==" $name }}
        
            {{ $pageName = lower .Params.name }}
            {{ if eq $pageName $name }}
                {{ if eq $url "" }}
                    {{ $url = .Permalink }}
                {{ end }}
                {{ if eq $currentPage $url }}
                    {{ $active = true }}
                {{ end }}
            {{ end }}
            <li{{ if eq $active true }} class="active"{{ end }}><a href ="{{ $url }}">{{ $title }}</a></li>
        {{ end }}
        
    {{ end }}
        </ul>
    {{ end }}

</li>
{{- /* <!--create the sub nav --> */ -}}

    

{{ end }}
{{ end }}
