{{ $size := .page.grid.columns | default "4" }}

<div class="container" id="loading_content" style="visibility: visible; display: block;">
<div class="masonry-container work-grid row-{{ $size }}">
<!-- <div class="gutter-guide"></div> -->

{{ $total := len .page.grid.items }}
{{ range $index, $grid_items := .page.grid.items }}
{{ $name := .name }}
{{ $order := $index }}

{{ range $index, $item := $.global.Site.Data.placeholder.work }}

{{ if eq .name $name }}
{{ $logo_src := .logo | default "/images/clients/color/quantum.svg" }}
{{ $logo := resources.Get $logo_src }}
{{ $thumb_src := .thumbnail | default "/images/placeholder/ddn-cover.png" }}
{{ $thumb := resources.Get $thumb_src }}

<div class='{{ with .tags }}{{ delimit . " " }}{{ end }} gridgrow'>
  <a class="work-link gridgrow-link" href='{{ .link | default "x" }}' title="{{ .title | safeHTML }}"><span>{{ .title | safeHTML }}</span></a>
  <div class="gridwrap background-night">
    <div class="flex-center gridgrow-image-holder" style="background-color: {{ .background }};">
      <div class="gridgrow-image lazyload lazypreload" data-bg='{{ $thumb.Permalink }}' style='background-position-y: 60%;'></div>
      <div style="background-color: {{ .background }};" class="wipe">
      </div>
    </div>
  <div class="card-footer background-night color-white" itemprop="description">
  <div class="excerpt-group">
  <div class="card-logo-holder flex-center-vertical">
  <img class="card-logo" src="{{ $logo.Permalink }}">
  </div>
  <h6 class="gridgrow-excerpt strip-margin">{{ .title | safeHTML }}</h6>
    <span class="card-footer-layer flex h_children_center hover-right">
      <h6 class="gridgrow-view strip-margin">View Case Study</h6>
      <svg class="color-white" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve">
      <g>
      <line fill="none" stroke="#ffffff" stroke-width="2" stroke-miterlimit="10" x1="0" y1="32" x2="63" y2="32"></line>
      </g>
      <polyline fill="none" stroke="#ffffff" stroke-width="2" stroke-linejoin="bevel" stroke-miterlimit="10" points="54,41 63,32 
                        54,23 "></polyline>
      </svg>
    </span>
  </div>
  
  </div>
  </div>
</div>
{{ end }}
{{ end }}
{{ end }}

</div>
</div>

{{ $velocity := resources.Get "js/plugins/velocity.min.js" | minify }}

<script type="text/javascript" src="{{ $velocity.Permalink }}"></script>

<script type="text/javascript">

document.addEventListener("DOMContentLoaded", function(){
  gridImageSize();
  animateGrid();
});

window.addEventListener("resize", function() {
  gridImageSize();
});
function gridImageSize(){
  let gridImage = document.querySelectorAll(".gridgrow-image");
  let gridgrowHeight = document.querySelector(".gridgrow-image-holder").offsetHeight;
  let gridgrowWidth = document.querySelector(".gridgrow-link").offsetWidth;

  gridImage.forEach(function(image, index){

    image.style.height = gridgrowHeight * .7 + "px";
    image.style.width = gridgrowWidth * .7 + "px";
    console.log(gridgrowWidth);
  });
}

function animateGrid(){

  let gridItems = document.querySelectorAll(".gridgrow");
  let gridLinks = document.querySelectorAll(".gridgrow a");
  let grid = document.querySelector(".work-grid");
  let windowHeight = window.innerHeight;
  let windowWidth = window.innerWidth;
  let itemOffsetLeft;
  let itemOffsetTop;
  let wipeOffsetLeft;
  let wipeOffsetTop;
  
  //animateItem();
  
  function clicky(e) {
    gridItems.forEach(function(item, index) {
      item.addEventListener("click", function(e) {
        e.preventDefault();
      });

      if ( !item.classList.contains("active") ) {
        
        let animateClick = function (e) {
          document.querySelector("html").style.overflow = "hidden";
          console.log(e.currentTarget);
          item = e.currentTarget;
          animateItem(item, animateClick);
        }

        item.addEventListener("click", animateClick, true);

      } else {
        //item.removeEventListener("click", animateClick, true);
      }
    }); 
  }
 clicky();
  

function animateItem(item, animateClick) {
  let wipe = item.querySelector(".wipe");
  
    itemOffsetLeft = (item.offsetLeft + item.offsetParent.offsetLeft) - window.scrollX;
    itemOffsetTop = (item.offsetTop + item.offsetParent.offsetTop) - window.scrollY;
    wipeOffsetLeft = (wipe.offsetLeft + item.offsetParent.offsetLeft) - window.scrollX;
    console.log(`wipe left: ${wipe.offsetParent.offsetLeft}`);
    let startPosTop = item.offsetTop;
    let startPosLeft = item.offsetLeft;
    let startImageWidth = item.querySelector(".gridgrow-image").width;
    let startImageHeight = item.querySelector(".gridgrow-image").height;
    
    let startWipeHeight = "589px";
    let startWipeWidth = "589px";
    let startWipeTop = item.offsetTop;
    console.log("wipe width: " + startWipeWidth);
    console.log(`Start top: ${startPosTop} Left: ${startPosLeft} Width: ${startImageWidth} height: ${startImageHeight}`);
    console.log(`Offsetleft: ${itemOffsetLeft} Offsettop: ${itemOffsetTop}`);

    item.style.overflow = "visible";
    item.querySelector(".gridwrap").style.overflow = "visible";
    item.querySelector(".gridgrow-image-holder").style.overflow = "visible";
    
    wipe.velocity({
      // width: [windowWidth, startWipeWidth],
      // height: [windowHeight, startWipeHeight],
      transform: ["scale(20)", "scale(1)"],
      "z-index": 33,
    }, {
      delay: 100,
      duration: 1800,
      /* Velocity's default options */
      progress: function(complete, remaining, start, tweenValue) {
        if (complete === 1) {
          wipe.setAttribute("style", `width: ${windowWidth}px; height: ${windowHeight}px; left: 0px; right: 0px; top: 0px; z-index: 888;`);
        }
      }
    });

//need to adjust this to use gridgrow image (".gridgrow-image")
    item.velocity({
      width: windowWidth,
      height: windowHeight,
      left: ["1px", "0px"],
      right: ["1px", "0px"],
      top: ["1px", "0px"],
      transform: [`translate(-${itemOffsetLeft}px, -${itemOffsetTop}px)`, `translate(0px, 0px)`],
      position: "relative"
    }, {
      /* Velocity's default options */
      
      progress: function(complete, remaining, start, tweenValue) {
        console.log(complete);
        if (complete === 1) {
          item.setAttribute("style", `transform: translate(-${itemOffsetLeft}px, -${itemOffsetTop}px); width: ${windowWidth}px; height: ${windowHeight}px; left: 0px; right: 0px; top: 0px; z-index: 999;`);
          item.style.overflowY = "scroll";
          item.style.overflowX = "hidden";
          item.classList.add('active');
          item.removeEventListener("click", animateClick, true);
          clicky();
        }
    },
      duration: 800,
      delay: 300,
      easing: "swing",
      queue: "",
      begin: undefined,
      complete: undefined,
      display: undefined,
      visibility: undefined,
      loop: false,
      mobileHA: true
    });

    function reverseAnimation() {
      console.log("reverse");
    }
    
}
  
}

</script>