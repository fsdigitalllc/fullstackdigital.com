{{ $size := .page.grid.columns | default "4" }}
{{ $tabs := .page.grid.tabs | default true }}
{{ $layout := .page.grid.layout | default "grid" }}
{{ $category := .page.grid.category | default "brand" }}
{{ $count := .page.grid.count | default "4" }}
{{ $featured := false }}
{{ $manuallySet := "" }}
{{ if eq $layout "row" }}
  {{ $size = "1" }}
  {{ $featured = true }}
{{ end }}
{{ if eq $tabs true }}

<div class="work-grid-tabs container padding-s-bottom">
  <div class="flex h_children_space-between">
    <div class="brand active" data-aos="fade" data-aos-delay="200" data-aos-duration="1400" data-filter="brand">
        <svg class="padding-xs-bottom" id="Layer_1" width="44" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
          <path stroke-width="2" stroke-miterlimit="10" d="M1,21c0,20,31,38,31,38s31-18,31-38  c0-8.285-6-16-15-16c-8.285,0-16,5.715-16,14c0-8.285-7.715-14-16-14C7,5,1,12.715,1,21z"></path>
          </svg>
        <span>Brand</span>
      </div>
      <div class="web" data-aos="fade" data-aos-delay="400" data-aos-duration="1400" data-filter="web">
          <svg id="Layer_1" width="44" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
            <g>
            <rect x="1" y="10" stroke-width="2" stroke-miterlimit="10" width="62" height="41"></rect>
            <line stroke-width="2" stroke-miterlimit="10" x1="22" y1="63" x2="42" y2="63"></line>
            <line stroke-width="2" stroke-miterlimit="10" x1="32" y1="63" x2="32" y2="51"></line>
            </g>
            <line stroke-width="2" stroke-miterlimit="10" x1="1" y1="43" x2="64" y2="43"></line>
            </svg>
          <span>Web</span>
        </div>
        <div class="market" data-aos="fade" data-aos-delay="600" data-aos-duration="1400" data-filter="market">
          <svg id="Layer_1" width="44" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
            <polygon stroke-width="2" stroke-miterlimit="10" points="26,49.042 54.963,49.042 54.963,11.042   1,11.042 1,49.042 14,49.042 14,59.486 "></polygon>
            <polyline stroke-width="2" stroke-miterlimit="10" points="57,41.042 62.963,41.042 62.963,3.042   9,3.042 9,9 "></polyline>
            </svg>
          <span>Market</span>
        </div>  
        </div>
</div>

{{ end }}
<div class="container-m width-spacer" style="height: 10px;background-color: #000;border-left: 40px solid red;border-right: 40px solid red;"></div>
<div class="container work-{{ $layout }} work-outer" id="loading_content" style="visibility: visible; display: block;">
<div class="work-container type-{{ $size }}">
<!-- <div class="gutter-guide"></div> -->

{{ $query := (where $.global.Site.RegularPages "Section" "work") }}

{{ if $featured }}
  {{ $query = first $count (sort (where (where $.global.Site.RegularPages "Section" "work") ".Params.grid_item.featured" "==" true) ".Params.grid_item.weight" "asc") }}
{{ end }}


{{ if and (eq $featured false) (eq $tabs false) }}

{{ $.global.Scratch.Set "manuallySet" "" }}
{{ $.global.Scratch.Set "path" "" }}

  {{ range .page.grid.items }}
    {{ $theName := .name | string }}
    {{ $theName = print $theName " " }}
    {{ $.global.Scratch.Add "manuallySet" $theName }}
  {{ end }}

  {{ $manuallySet = $.global.Scratch.Get "manuallySet" }}
  
  {{ range (where $.global.Site.RegularPages "Section" "work" ) }}
    {{ if in $manuallySet .Params.name }}
      {{ $.global.Scratch.Add "path" .Path }}
    {{ end }}
  {{ end }}
  
  {{ $thePath :=  $.global.Scratch.Get "path" }}

{{ $query = first $count (sort (where (where $.global.Site.RegularPages "Section" "work") ".Path" "in" $thePath ) ".Params.grid_item.weight" "asc") }}

{{ end }}

{{ range $index, $items := $query }}
{{ $tag := "" }}
{{ if in .Path "market" }}
  {{ $tag = "market" }}
{{ end }}
{{ if in .Path "web" }}
  {{ $tag = "web" }}
{{ end }}
{{ if in .Path "brand" }}
  {{ $tag = "brand" }}
{{ end }}

<!--way too much effort to grab the client logo for the grid item-->
{{ $prefix := "assets/images/clients/" }}
{{ $asset_prefix := "images/clients/" }}
{{ $context := .Params.stacks_hero }}
{{ $image := .Resources.GetMatch $context.image }}
{{ $logo := "" }}
{{ $name := $context.client }}
  {{ if $featured }}
    {{ $prefix = "assets/images/clients/grey/" }}
    {{ $asset_prefix = "images/clients/grey/" }}
  {{ else if or (eq .Params.grid_item.logo_color "color") (eq .Params.grid_item.logo_color true ) }}
    {{ $prefix = "assets/images/clients/color/" }}
    {{ $asset_prefix = "images/clients/color/" }}
  {{ else if or (eq .Params.grid_item.logo_color "white") (eq .Params.grid_item.logo_color false ) }}
    {{ $prefix = "assets/images/clients/white/" }}
    {{ $asset_prefix = "images/clients/white/" }}
  {{ else if or (eq .Params.grid_item.logo_color "black") }}
    {{ $prefix = "assets/images/clients/black/" }}
    {{ $asset_prefix = "images/clients/black/" }}
  {{ end }}
  
{{ range $.global.Site.Data.lookup.clients }}
  {{ if eq .name $name }}
    {{ $logo = .image }}
  {{ end }}
{{ end }}

{{ $path := print $prefix $logo }}
{{ $assetpath := print $asset_prefix $logo }}
<div{{ if $featured }} style="background-color: {{ .Params.stacks_hero.background_color | safeHTML }};"{{ end }} class='gridgrow' data-item-filter="{{ $tag }}">
  <a class="work-link gridgrow-link" href='{{ .URL }}' title=""><span>{{ .Title | safeHTML }}</span></a>
  {{ if $featured }}
  <div style="background-color: {{ .Params.stacks_hero.background_color | safeHTML }};" class="wipe"></div>
  {{ end }}
  <div{{ if $featured }} style="background-color: {{ .Params.stacks_hero.background_color | safeHTML }};"{{ end }} class="gridwrap background-light">

    <div class="flex-center gridgrow-image-holder" style="background-color: {{ .Params.stacks_hero.background_color | safeHTML }};">

      <img class="gridgrow-image {{ $name }}" width="50%" data-src='{{ $image.Permalink }}'>

      {{ if eq $featured false }}
      <div style="background-color: {{ .Params.stacks_hero.background_color | safeHTML }};" class="wipe"></div>
      {{ end }}
      
    </div>

  <div{{ if $featured }} style="background-color: {{ .Params.stacks_hero.background_color | safeHTML }};"{{ end }} class="card-footer" itemprop="description">
  <div class="excerpt-group">
  <div class="card-logo-holder flex-center-vertical">
  {{ if (fileExists $path) }}
  {{ $imagesrc := resources.Get $assetpath }}
  <img class="card-logo lazyload lazypreload {{ $name }}" src="{{ $imagesrc.Permalink }}">
  {{ end }}
  </div>
  {{ if $featured }}
    <h2 class="color-white">{{ .Params.grid_item.featured_title | safeHTML | default "FEATURED TITLE" }}</h2>
    <h3>{{ .Params.grid_item.featured_caption | safeHTML | default "FEATURED TITLE" }}</h3>
    <a class="button fill white" href='{{ .URL }}'>Read the Story</a>
    <h6 class="gridgrow-excerpt strip-margin">{{ .Title | safeHTML }}</h6>
  
    <span class="card-footer-layer flex h_children_center hover-right">
      <h6 class="gridgrow-view strip-margin">View Case Study</h6>
      <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve">
      <g>
      <line fill="none" stroke-width="2" stroke-miterlimit="10" x1="0" y1="32" x2="63" y2="32"></line>
      </g>
      <polyline fill="none" stroke-width="2" stroke-linejoin="bevel" stroke-miterlimit="10" points="54,41 63,32 
                        54,23 "></polyline>
      </svg>
    </span>
  {{ else }}
    <h6 class="gridgrow-excerpt strip-margin">{{ .Title | safeHTML }}</h6>
  
    <span class="card-footer-layer flex h_children_center hover-right">
      <h6 class="gridgrow-view strip-margin">View Case Study</h6>
      <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve">
      <g>
      <line fill="none" stroke-width="2" stroke-miterlimit="10" x1="0" y1="32" x2="63" y2="32"></line>
      </g>
      <polyline fill="none" stroke-width="2" stroke-linejoin="bevel" stroke-miterlimit="10" points="54,41 63,32 
                        54,23 "></polyline>
      </svg>
    </span>
    {{ end }}
  </div>
  
  </div>
  </div>
  
</div>

{{ end }}
</div>

</div>

<div class="height-spacer"><div id="project-summary" class="container padding-m-top padding-m-bottom flex h_children_space-between break-t"><div class="col-3 t-col-8 grid"><img class="client_logo lazypreload lazyloaded" src=""><div class="flex tiny color-oil padding-s-top strip-padding-tablet h_children_space-between"><ul><li class="active">Brand</li><li class="active">Development</li><li class="active">Identity</li><li>Strategy</li></ul><ul><li>Web</li><li>Experience</li><li>Design</li><li>Development</li></ul><ul><li>Market</li><li>Search</li><li>Content</li><li>Social</li></ul></div></div><div class="col-8 flex v_c-center maxwidth-s t-col-12"><h1 class="page-title strip-margin-bottom color-oil"></h1></div></div></div>
<div class="work-ajax"></div>

{{ $velocity := resources.Get "js/plugins/velocity.min.js" | minify }}
{{ $scroll_lock := resources.Get "js/plugins/bodyScrollLock.js" | minify }}
<script type="text/javascript" src="{{ $velocity.Permalink }}"></script>
<script type="text/javascript" src="{{ $scroll_lock.Permalink }}"></script>

{{ if eq $tabs true }}
{{ $filter_grid := resources.Get "js/work/filter_grid.js" }}
<script type="text/javascript" src="{{ $filter_grid.Permalink }}"></script>
{{ end }}

{{ if eq $featured true }}
{{ $featured_grid := resources.Get "js/work/featured_grid.js" }}
<script type="text/javascript" src="{{ $featured_grid.Permalink }}"></script>
{{ end }}

{{ $animate_grid := resources.Get "js/work/animate_grid.js" }}
{{ $util := resources.Get "js/util.js" }}

<script type="text/javascript">
  fetchInject([
    '{{ $animate_grid.Permalink }}'
  ], fetchInject([
    '{{ $util.Permalink }}'
  ]))
</script>